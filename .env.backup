# G6 Platform Environment Variables
# Authentication secrets only - all other config in JSON files

# Kite Connect API (Required)
# Public key issued by provider; identifies your app
KITE_API_KEY=j9f5yixi8xarailr
# Secret used to sign/validate sessions; keep confidential
KITE_API_SECRET=antq6r60igsod0xxcggnjxjix6dqlnyn

# InfluxDB Authentication (Required if using InfluxDB)  
# InfluxDB API token used by sinks/dashboards to write/read
INFLUX_TOKEN=Mh-ekPXdbsBbmFfAB2rtykY9CuL2KnWktm_odwxfNR64z1MBroBIUD9KlCoUVjWcnVx1K3eHOs6peLtCcGbEaw==
# Path to influxd executable for local development convenience
G6_INFLUXD_EXE=C:\Program Files\InfluxData\influxdb\influxd.exe


# Optional runtime overrides (usually not needed)
# RUN_INTERVAL_SEC=60
# RUN_OFFSET_SEC=0
# LOG_LEVEL=INFO
# Emit a human-friendly settings snapshot on startup
G6_SETTINGS_SUMMARY_HUMAN=1

# Enable richer console tables and banners
G6_ENHANCED_UI=1



# ---- General Formatting / Headers ----
G6_SINGLE_HEADER_MODE=1            # When 1 emit daily header once centrally (orchestrator) instead of per invocation
G6_DISABLE_REPEAT_BANNERS=1        # Suppress repeat DAILY header / market-open banners (set 0 to allow repeats)
G6_COMPACT_BANNERS=0               # When 1 use compact single-line daily header instead of block style
G6_DAILY_HEADER_EVERY_CYCLE=0      # Force daily header each cycle (overrides SINGLE_HEADER_MODE) - diagnostic
G6_BANNER_DEBUG=0                  # When 1 emit debug lines explaining why banners were suppressed

# ---- Phase Timing & Performance ----
G6_PHASE_TIMING_MERGE=1            # Merge phase timing segments into single dict (auto-enabled by SINGLE_HEADER_MODE)
G6_PHASE_TIMING_SINGLE_EMIT=1      # Emit merged timing once near end of collectors (suppresses intermediate merged lines)
G6_GLOBAL_PHASE_TIMING=0           # NEW: When 1 suppress all PHASE_TIMING_MERGED lines and emit single PHASE_TIMING_GLOBAL per cycle (orchestrator)

# ---- Cycle Tables / Human Summaries ----
G6_DISABLE_CYCLE_TABLES=0          # Disable human-readable cycle tables entirely
G6_DEFER_CYCLE_TABLES=0            # When 1 buffer cycle tables and flush once at orchestrator end-of-run
G6_CYCLE_TABLE_GRACE_MS=120        # Delay (ms) after collectors finish before flushing tables (allow late stats)
G6_CYCLE_TABLE_GRACE_MAX_MS=500    # Hard cap for cumulative grace delays during run
G6_DEFER_CYCLE_TABLES=0            # (duplicate for clarity) keep 0 unless you need end-of-run only tables

# ---- Structured Logging & Compact Mode ----
G6_STRUCT_COMPACT=0                # When 1 apply payload compaction to structured events
G6_DISABLE_COLOR=0                 # Set 1 to disable ANSI color codes in human tables / banners

# ---- FINNIFTY / Index Specific Handling ----
# FINNIFTY strike selection: only collect strikes multiple of 100 & disable adaptive widening
# (Behaviour is automatic; toggle not required. Provided for discoverability.)
G6_FINNIFTY_STRICT_100=1           # If set 0 disables the enforced modulo=100 strike filter (not recommended)

# ---- Adaptive / Scaling ----
G6_ADAPTIVE_SCALE_PASSTHROUGH=0    # Experimental: pass external adaptive scale_factor to strike builder

# ---- Late / Stale / Outage Detection ----
G6_PROVIDER_OUTAGE_THRESHOLD=3     # Cycles all indices empty before outage classification
G6_PROVIDER_OUTAGE_LOG_EVERY=5     # Log outage every N cycles after first detection
G6_STALE_ABORT_CYCLES=10           # When stale mode=abort: cycles before abort classification
G6_STALE_WRITE_MODE=mark           # mark|abort behaviour for stale cycles

# ---- Misc Metrics / Behaviour ----
G6_CYCLE_INTERVAL=60               # Nominal cycle interval seconds (used for SLA computation)
G6_CYCLE_SLA_FRACTION=0.85         # Fraction of interval budget considered SLA success
G6_MISSING_CYCLE_FACTOR=2.0        # Factor*interval gap to increment missing_cycle counter

# ---- Snapshot / Pipeline Convenience ----
G6_AUTO_SNAPSHOTS=0                # Enable automatic snapshot caching
G6_SNAPSHOT_CACHE=0                # Persist snapshots in in-memory cache for cross-cycle reuse
G6_PIPELINE_COLLECTOR=0            # Alternate pipeline collector mode (experimental)

# ---- Diagnostics / Tracing ----
G6_IMPORT_TRACE=0                  # Verbose module import tracing (debug only)
G6_BANNER_DEBUG=0                  # Duplicate flag (see above) intentional for grouping

# Implementation Notes:
# * GLOBAL_PHASE_TIMING automatically benefits from existing merge+single emit; you do not need to set the other two when enabling it.
# * If GLOBAL_PHASE_TIMING=1 the intermediate PHASE_TIMING_MERGED and single-emit lines are suppressed; only PHASE_TIMING_GLOBAL appears.
# * Order of evaluation: unified_collectors records merged times -> global accumulator -> orchestrator emits once per cycle.
# * Defer tables + grace allows late-arriving analytics to appear in final flush without duplicate table spam.



# Core paths
# Grafana installation directory
GF_PATHS_HOME=C:\Program Files\GrafanaLabs\grafana\grafana-12.1.1
# Grafana data directory (provisioned outside Program Files)
GF_PATHS_DATA=C:\GrafanaData\data
# Grafana logs output directory
GF_PATHS_LOGS=C:\GrafanaData\log
# Grafana plugins directory
GF_PATHS_PLUGINS=C:\GrafanaData\plugins
# Grafana provisioning directory (datasources/dashboards)
GF_PATHS_PROVISIONING=C:\Users\ASUS\Documents\G6\qq\g6_reorganized\grafana\provisioning

# Server port (optional)
GF_SERVER_HTTP_PORT=3000

#################################################################
# Appended Development Overrides (2025-09-26)
# These are non-secret operational toggles. Adjust as needed.
# Source template: .env.example (see for full commentary)
#################################################################

# Directory where generated panel JSON files are written
G6_PANELS_DIR=data/panels
# Enable summary-mode panels (compact dashboards)
G6_SUMMARY_PANELS_MODE=on
G6_STALE_WRITE_MODE=mark		# (enum: allow | mark | skip | abort)
# Minimum required field coverage to treat a row as non-stale (0–1)
G6_STALE_FIELD_COV_THRESHOLD=0.05
# Force weekend behavior (1 to treat weekend like weekday for testing)
G6_WEEKEND_MODE=0
# Allow collections to run during weekends if non-zero
G6_WEEKEND_ALLOW_COLLECTION=1


# --- Core Loop ---
# Target cycle interval in seconds for collectors/orchestrator
G6_CYCLE_INTERVAL=60
# SLA threshold: fraction of interval to complete within (e.g., 0.85 = 85%)
G6_CYCLE_SLA_FRACTION=0.85

# --- Parallel Collection ---
# Controls concurrency of per-index collection. Higher values increase API pressure; lower values reduce 429s at the cost of throughput.
# Enable/scale index-level parallelism (1 = on in most setups; increase with caution)
G6_PARALLEL_INDICES=1
# Maximum worker threads used per cycle for index collection (reduce to lower concurrent API calls)
G6_PARALLEL_INDEX_WORKERS=2
# Timeout (seconds) for a single index worker before it is considered stalled
G6_PARALLEL_INDEX_TIMEOUT_SEC=15
# Fraction of the total cycle time budget allowed for parallel work before we skip/defer remaining tasks
G6_PARALLEL_CYCLE_BUDGET_FRACTION=0.9

# --- Expiry Service & Misclassification Detection ---
# Enable central expiry resolution service
G6_EXPIRY_SERVICE=1
# Detect and flag expiry misclassifications in collected data
G6_EXPIRY_MISCLASS_DETECT=1
G6_EXPIRY_MISCLASS_DEBUG=1      # Set to 0 after confirming behavior
G6_EXPIRY_MISCLASS_SKIP=0       # Set 1 to suppress anomalous rows

# --- CSV Junk Filter (kept neutral; enable thresholds later) ---
# Enable junk filtering for CSV sink (auto/off/on)
G6_CSV_JUNK_ENABLE=auto
# Minimum total open interest across both legs to keep a row
G6_CSV_JUNK_MIN_TOTAL_OI=0
# Minimum total volume across both legs to keep a row
G6_CSV_JUNK_MIN_TOTAL_VOL=0
# Minimum per-leg open interest threshold
G6_CSV_JUNK_MIN_LEG_OI=0
# Minimum per-leg volume threshold
G6_CSV_JUNK_MIN_LEG_VOL=0
# Rows older than this (seconds) are treated as stale
G6_CSV_JUNK_STALE_THRESHOLD=0
# Emit junk summary every N seconds (0 disables periodic summary)
G6_CSV_JUNK_SUMMARY_INTERVAL=0
# Enable verbose junk filtering diagnostics in logs
G6_CSV_JUNK_DEBUG=0

# --- Metrics / Cardinality ---
# Enable cardinality guard for metrics emission
G6_METRICS_CARD_ENABLED=1
# Hard cap on total active series (0 = unlimited, use with caution)
G6_CARDINALITY_MAX_SERIES=0
# Fraction at which to re-enable metrics after hitting the cap
G6_CARDINALITY_REENABLE_FRACTION=0.7
# Minimum seconds to keep suppression active once triggered
G6_CARDINALITY_MIN_DISABLE_SECONDS=300

# --- Panels / Output ---
# Comma-separated sinks to emit (csv, logging, panels, ...)
G6_OUTPUT_SINKS=csv,logging,panels
G6_PANELS_DIR=data/panels   # Panels mode auto-detected (G6_SUMMARY_PANELS_MODE removed 2025-10)

# --- Logging ---
# Minimum console/log level (DEBUG, INFO, WARNING, ERROR)
G6_OUTPUT_LEVEL=WARNING
# Use compact, single-line logs for most events
G6_CONCISE_LOGS=1
# Enable colored, styled console output
G6_FANCY_CONSOLE=1
# Emit logs in JSON format (0 = human-readable)
G6_JSON_LOGS=0
G6_LOG_COLOR_MODE=on 				# (auto|on|off)


# Noise suppression

# Suppress grouped metrics banner lines to reduce console noise
G6_SUPPRESS_GROUPED_METRICS_BANNER=1		# spam metrics terminal logs
# Suppress duplicate metrics warning lines
G6_SUPPRESS_DUPLICATE_METRICS_WARN=1		# spam metrics terminal logs
# Force daily header to print every cycle (1) instead of once
G6_DAILY_HEADER_EVERY_CYCLE=1

#G6_DUPLICATES_LOG_LEVEL

G6_STRUCT_EVENTS_FORMAT=human 			# (json|human|both)



# --- Memory Pressure Tiers ---
# Soft memory thresholds (MB) to trigger tiered behavior/backoff
G6_MEMORY_LEVEL1_MB=200
G6_MEMORY_LEVEL2_MB=300
G6_MEMORY_LEVEL3_MB=500

# --- Greeks / IV (disabled for speed) ---
# Compute Greeks during enrichment (costly; keep off for speed)
G6_COMPUTE_GREEKS=0
# Estimate implied volatility where absent (adds CPU time)
G6_ESTIMATE_IV=0

# --- Retry / Circuit Breaker (conservative defaults) ---
# Enable provider-level retries for transient failures
G6_RETRY_PROVIDERS=0
# Consecutive failures before opening the circuit
G6_CB_FAILURES=5
# Minimum seconds before circuit attempts half-open
G6_CB_MIN_RESET=5
# Maximum seconds backoff window for circuit resets
G6_CB_MAX_RESET=30
# Base backoff seconds for circuit breaker resets
G6_CB_BACKOFF=5
# Add jitter (0–1) to spread retries and avoid thundering herd
G6_CB_JITTER=0.1

# Retry configuration for network/API errors
# Whitelist: exceptions that should trigger retries
G6_RETRY_WHITELIST=TimeoutError,ConnectionError,kiteconnect.exceptions.NetworkException
# Max retry attempts before giving up
G6_RETRY_MAX_ATTEMPTS=4
# Max total time in seconds for all retries
G6_RETRY_MAX_SECONDS=15
# Base backoff in seconds (exponential backoff multiplier)
G6_RETRY_BACKOFF=1.0
# Enable jitter to avoid thundering herd
G6_RETRY_JITTER=1

# --- Optional Test Suites (off) ---
# Enable optional/extended test suites
G6_ENABLE_OPTIONAL_TESTS=0
# Enable performance tests
G6_ENABLE_PERF_TESTS=0
# Enable slow/integration tests
G6_ENABLE_SLOW_TESTS=0

# --- Manual Quick Toggles (uncomment as needed) ---
# G6_FORCE_MARKET_OPEN=1
# G6_EXPIRY_MISCLASS_SKIP=1
# G6_CSV_JUNK_DEBUG=1

# End appended development block
# Session access token for Kite (required for real API; leave unset to force synthetic/demo mode)


# ------------------------------------------------------------------
# Kite API stability: rate limit, batching, and cache tuning (2025-10-28)
# These settings reduce provider 429/"Too many requests" while keeping
# expiry/date logic unchanged. Tweak QPS and window to suit your quota.
#
# Enable token-bucket limiter for kite.quote (used by quote_fetch & batcher)
G6_KITE_LIMITER=1
# Sustained calls per second (qps) and burst capacity
G6_KITE_QPS=2
G6_KITE_RATE_MAX_BURST=4
# Open cooldown after N consecutive 429s; cooldown length seconds
G6_KITE_RATE_CONSECUTIVE_THRESHOLD=2
G6_KITE_RATE_COOLDOWN_SECONDS=30

# Micro-batch near-simultaneous quote calls into one network request
G6_KITE_QUOTE_BATCH=1
# Batch window in milliseconds (trade-off: 10–30ms usually safe)
G6_KITE_QUOTE_BATCH_WINDOW_MS=20

# Quote cache TTL seconds (fast-path for repeated symbols within a cycle)
G6_KITE_QUOTE_CACHE_SECONDS=2.0

# Optional: legacy per-call throttle hook (not a sleeper; safe to keep 0)
# G6_KITE_THROTTLE_MS=0
# ------------------------------------------------------------------

# Provider timeouts (quotes and instruments); modest headroom reduces spurious timeouts
G6_KITE_TIMEOUT_SEC=5.0
G6_KITE_INSTRUMENTS_TIMEOUT_SEC=10.0

# Skip real LTP fetch on rate limit errors to avoid extra API pressure
G6_QUOTE_SKIP_LTP_ON_RATELIMIT=1
KITE_ACCESS_TOKEN=Ol2V6UlWv55M3FTQWD2nJ8670j5xXsuc
